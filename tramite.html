<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trámite</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <header class="container-fluid">
    <div class="container">
      <div class="row align-items-center py-3">
        <div
          class="col-12 col-lg-8 d-flex flex-column flex-lg-row align-items-center justify-content-center justify-content-lg-start mb-2 mb-lg-0 order-0 order-lg-0">
          <div
            class="col-12 col-lg-4 text-center text-lg-start d-flex justify-content-center align-items-center mb-2 mb-lg-0">
            <a href="/"><img src="img/logo-reniec-azul.png" alt="RENIEC Logo" class="img-fluid"></a>
            <img src="img/usser.png" alt="Icono Usuario" class="img-fluid ms-3 d-block d-lg-none" width="40">
          </div>
          <div class="col-12 col-lg-8 flex-grow-1 mb-2 mb-lg-0 d-block d-lg-block">
            <input type="text" class="form-control" placeholder="Ingresa tu consulta">
          </div>
        </div>
        <div class="col-lg-2 text-end d-none d-lg-block order-lg-1">
          <a href="reniec2.html"><img src="img/usser.png" alt="Icono Usuario" class="img-fluid" width="40"></a>
        </div>
      </div>
    </div>
  </header>
  <nav class="container-fluid" id="nav-fluid">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <ul class="nav justify-content-center" id="nav-ul">
            <li class="nav-item"><a class="nav-link" href="/">INICIO</a></li>
            <li class="nav-item"><a class="nav-link" href="tramite.html">TRAMITES</a></li>
            <li class="nav-item"><a class="nav-link" href="#">SERVICIOS EN LÍNEA</a></li>
            <li class="nav-item"><a class="nav-link" href="#">CONÓCENOS</a></li>
            <li class="nav-item"><a class="nav-link" href="consulta.html">CONSULTA</a></li>
            <li class="nav-item"><a class="nav-link" href="#">REGISTRO ELECTORAL</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
  <section class="container my-5">
    <div class="row">
      <div class="col-md-6" id="renie">
        <img id="prin" src="img/reniec.jpg" alt="Imagen DNI" class="img-fluid rounded">
      </div>
      <div class="col-md-6">
        <h2 class="form-section-title mt-4">Tipo de Consulta <span class="required-star"></span></h2>
        <div class="mb-3">
          <label class="form-label question-label">Por favor, seleccione el tipo de consulta que desea realizar:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="tipoConsulta" id="consultaDNI" value="dni" required>
            <label class="form-check-label" for="consultaDNI">
              Trámites
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="tipoConsulta" id="consultaActas" value="actas">
            <label class="form-check-label" for="consultaActas">
              Consultas
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="tipoConsulta" id="consultaServicios" value="servicios">
            <label class="form-check-label" for="consultaServicios">
              Estado de trámites
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="tipoConsulta" id="otraConsulta" value="otra">
            <label class="form-check-label" for="otraConsulta">
              Otra consulta
            </label>
          </div>
        </div>
        <h2 class="form-section-title mt-4">Tipo de Consulta <span class="required-star"></span></h2>
        <select class="form-select form-select-sm" aria-label="Small select example">
          <option selected>Selecciona</option>
          <option value="1">Copia de actas</option>
          <option value="2">Renovacion</option>
          <option value="3">Citas</option>
          <option value="4">Duplicados</option>
          <option value="5">Copias de Actas</option>
        </select><br>
        <div class="container-fluid">
          <!-- <a href="validacion.html" class="mi-boton-personalizado">INICIAR</a> -->
        </div>
      </div>
      <h2 class="form-section-title mt-4">Detalle de la Consulta <span class="required-star">*</span></h2>
      <div class="mb-3">
        <label for="detalleConsulta" class="form-label question-label">Por favor, describa detalladamente su
          consulta:</label>
        <textarea class="form-control" id="detalleConsulta" rows="5" placeholder="Escriba aquí su consulta..."
          required></textarea>
      </div>
      <div class="form-check mb-4">
        <input class="form-check-input" type="checkbox" id="aceptarTerminos" required>
        <label class="form-check-label" for="aceptarTerminos">
          Acepto los términos y condiciones <span class="required-star">*</span>
        </label>
      </div>
      <div class="text-center">
        <button type="button" onclick="enviarConsulta()" class="mi-boton-personalizado">GESTIONAR CITA</button>
      </div>
      <div class="alert alert-primary mt-4 text-center fw-bold">
        Para consultas presenciales, se utilizará un lector biométrico para validar su identidad a través de su
        huelladactilar.
      </div>
    </div>
    </div>
  </section>
  <footer id="pie" class="container-fluid" style="background-color: #2d5873;">
    <div class="container py-4">
      <div class="row text-white">
        <div class="col-lg-3 col-12 mb-3 mb-lg-0 text-center text-lg-start">
          <img src="img/logofooter.png" alt="RENIEC Logo Footer" style="height: 40px;">
        </div><br><br><br>
        <div class="col-lg-3 col-6 mb-3 mb-lg-0">
          <div class="bg-transparent border-0 text-white">
            <div class="card-body p-0">
              <h6 class="card-title mb-2"><strong>Conócenos</strong></h6>
              <ul class="list-unstyled mb-0">
                <li>Sobre RENIEC</li>
                <li>Iniciativas y Recursos</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-6 mb-3 mb-lg-0">
          <div class=" bg-transparent border-0 text-white">
            <div class="card-body p-0">
              <h6 class="card-title mb-2"><strong>Ciudadano</strong></h6>
              <ul class="list-unstyled mb-0">
                <li>DNI</li>
                <li>Actas</li>
                <li>Certificados Digitales</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-12">
          <div class="bg-transparent border-0 text-white">
            <div class="card-body p-0">
              <h6 class="card-title mb-2"><strong>Servicios en línea</strong></h6>
              <ul class="list-unstyled mb-0">
                <li><a class="nav-link" href="reclamo.html">Reclamo</a></li>
                <li>Ciudadano</li>
                <li>Consultas</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script>
  function enviarConsulta() {
    // Obtener el tipo de consulta seleccionado
    const tipoConsultaRadio = document.querySelector('input[name="tipoConsulta"]:checked');
    const tipoTramiteSelect = document.querySelector('.form-select');
    const detalleConsulta = document.getElementById('detalleConsulta').value;
    const aceptarTerminos = document.getElementById('aceptarTerminos').checked;

    // Validaciones
    if (!tipoConsultaRadio) {
      alert('Por favor, seleccione un tipo de consulta.');
      return;
    }

    if (tipoTramiteSelect.value === 'Selecciona') {
      alert('Por favor, seleccione un tipo de trámite.');
      return;
    }

    if (!detalleConsulta.trim()) {
      alert('Por favor, describa su consulta.');
      return;
    }

    if (!aceptarTerminos) {
      alert('Debe aceptar los términos y condiciones.');
      return;
    }

    // Preparar datos para enviar
    const data = {
      tipo_consulta: tipoConsultaRadio.value,
      tipo_tramite: tipoTramiteSelect.options[tipoTramiteSelect.selectedIndex].text,
      detalle_tramite: detalleConsulta
    };

    console.log('Enviando datos:', data);

    // Enviar datos al backend
    fetch('https://reniec-3mfu.onrender.com/consulta/registrar', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
    .then(response => {
      if (response.ok) {
        return response.text(); // Cambiar a text() porque devuelve String
      }
      throw new Error('Error en el registro. Código de estado: ' + response.status);
    })
    .then(responseData => {
      console.log('Success:', responseData);
      // Guardar datos en localStorage
      localStorage.setItem('consultaRegistrada', JSON.stringify(data));
      alert('¡Consulta registrada con éxito!');
      // Limpiar formulario
      document.querySelector('input[name="tipoConsulta"]:checked').checked = false;
      tipoTramiteSelect.selectedIndex = 0;
      document.getElementById('detalleConsulta').value = '';
      document.getElementById('aceptarTerminos').checked = false;
      // Redirigir a validación
      window.location.href = 'validacion.html';
    })
    .catch((error) => {
      console.error('Error:', error);
      alert('Hubo un error al registrar la consulta. Por favor, inténtelo de nuevo.');
    });
  }
  </script>
</body>
</html>
